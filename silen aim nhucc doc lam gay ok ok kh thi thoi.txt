--// AIM TOGGLE BUTTON (PC + Mobile)
-- Based on your auto aim code

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- SETTINGS
local FOV_RADIUS = 100
local AIM_STRENGTH = 999 -- 0.5 = máº¡nh vá»«a, 1 = cá»±c máº¡nh
local FOV_COLOR = Color3.fromRGB(255, 255, 255)

-- UI setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FOV_UI"
screenGui.Parent = player:WaitForChild("PlayerGui")

-- FOV circle
local fovCircle = Instance.new("Frame")
fovCircle.Name = "FOVCircle"
fovCircle.Size = UDim2.fromOffset(FOV_RADIUS * 2, FOV_RADIUS * 2)
fovCircle.AnchorPoint = Vector2.new(0.5, 0.5)
fovCircle.Position = UDim2.fromScale(0.5, 0.5)
fovCircle.BorderSizePixel = 2
fovCircle.BorderColor3 = FOV_COLOR
fovCircle.BackgroundTransparency = 1
fovCircle.Parent = screenGui

-- AIM button
local aimButton = Instance.new("TextButton")
aimButton.Name = "AimToggleButton"
aimButton.Size = UDim2.fromScale(0.18, 0.1)
aimButton.Position = UDim2.fromScale(0.85, 0.8)
aimButton.AnchorPoint = Vector2.new(0.5, 0.5)
aimButton.Text = "ðŸŽ¯ AIM: OFF"
aimButton.TextScaled = true
aimButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
aimButton.TextColor3 = Color3.fromRGB(0, 0, 0)
aimButton.Visible = true
aimButton.Parent = screenGui

local aiming = false

-- Center of screen
local function getCenter()
	local viewport = camera.ViewportSize
	return Vector2.new(viewport.X / 2, viewport.Y / 2)
end

-- Find closest target in FOV
local function getClosestPlayer()
	local center = getCenter()
	local closest
	local shortest = math.huge

	for _, plr in pairs(Players:GetPlayers()) do
		if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
			local root = plr.Character.HumanoidRootPart
			local pos, visible = camera:WorldToViewportPoint(root.Position)
			if visible then
				local dist = (Vector2.new(pos.X, pos.Y) - center).Magnitude
				if dist < FOV_RADIUS and dist < shortest then
					closest = plr
					shortest = dist
				end
			end
		end
	end
	return closest
end

-- Highlight target
local function highlightTarget()
	local target = getClosestPlayer()
	for _, plr in pairs(Players:GetPlayers()) do
		if plr ~= player and plr.Character then
			local hl = plr.Character:FindFirstChildOfClass("Highlight")
			if target == plr then
				if not hl then
					hl = Instance.new("Highlight")
					hl.Parent = plr.Character
					hl.FillTransparency = 1
					hl.OutlineColor = FOV_COLOR
					hl.OutlineTransparency = 0
				end
			elseif hl then
				hl:Destroy()
			end
		end
	end
end

-- Update loop
RunService.RenderStepped:Connect(function()
	highlightTarget()

	if aiming then
		local target = getClosestPlayer()
		if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
			local root = target.Character.HumanoidRootPart
			camera.CFrame = camera.CFrame:Lerp(CFrame.lookAt(camera.CFrame.Position, root.Position), AIM_STRENGTH)
		end
	end
end)

-- Toggle aim when pressing button (mobile/PC)
aimButton.MouseButton1Click:Connect(function()
	aiming = not aiming
	if aiming then
		aimButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
		aimButton.Text = "ðŸŽ¯ AIM: ON"
	else
		aimButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
		aimButton.Text = "ðŸŽ¯ AIM: OFF"
	end
end)

-- Optional: Toggle with keyboard (for PC)
UserInputService.InputBegan:Connect(function(input, gp)
	if gp then return end
	if input.KeyCode == Enum.KeyCode.E then
		aiming = not aiming
		if aiming then
			aimButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
			aimButton.Text = "ðŸŽ¯ AIM: ON"
		else
			aimButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
			aimButton.Text = "ðŸŽ¯ AIM: OFF"
		end
	end
end)