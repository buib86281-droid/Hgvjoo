--// AUTO AIM STRONG (PC + Mobile)
-- Place inside StarterPlayerScripts > LocalScript

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- SETTINGS
local FOV_RADIUS = 100 -- tăng FOV
local AIM_STRENGTH = 27 -- 1 = aim mạnh nhất
local FOV_COLOR = Color3.fromRGB(255, 255, 255)

-- UI setup (vòng tròn FOV)
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FOV_UI"
screenGui.Parent = player:WaitForChild("PlayerGui")

local fovCircle = Instance.new("Frame")
fovCircle.Name = "FOVCircle"
fovCircle.Size = UDim2.fromOffset(FOV_RADIUS * 2, FOV_RADIUS * 2)
fovCircle.AnchorPoint = Vector2.new(0.5, 0.5)
fovCircle.Position = UDim2.fromScale(0.5, 0.5)
fovCircle.BorderSizePixel = 2
fovCircle.BorderColor3 = FOV_COLOR
fovCircle.BackgroundTransparency = 1
fovCircle.Parent = screenGui

-- Get screen center (mobile & PC)
local function getCenter()
	local viewport = camera.ViewportSize
	return Vector2.new(viewport.X / 2, viewport.Y / 2)
end

-- Find closest target in FOV
local function getClosestPlayer()
	local center = getCenter()
	local closest
	local shortest = math.huge

	for _, plr in pairs(Players:GetPlayers()) do
		if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
			local root = plr.Character.HumanoidRootPart
			local pos, visible = camera:WorldToViewportPoint(root.Position)
			if visible then
				local dist = (Vector2.new(pos.X, pos.Y) - center).Magnitude
				if dist < FOV_RADIUS and dist < shortest then
					closest = plr
					shortest = dist
				end
			end
		end
	end
	return closest
end

-- Highlight target in FOV
local function highlightTarget()
	local target = getClosestPlayer()
	for _, plr in pairs(Players:GetPlayers()) do
		if plr ~= player and plr.Character then
			local hl = plr.Character:FindFirstChildOfClass("Highlight")
			if target == plr then
				if not hl then
					hl = Instance.new("Highlight")
					hl.Parent = plr.Character
					hl.FillTransparency = 1
					hl.OutlineColor = FOV_COLOR
					hl.OutlineTransparency = 0
				end
			elseif hl then
				hl:Destroy()
			end
		end
	end
end

RunService.RenderStepped:Connect(highlightTarget)

-- Khi người chơi ấn bắn (chuột hoặc chạm màn hình)
UserInputService.InputBegan:Connect(function(input, gp)
	if gp then return end
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		local target = getClosestPlayer()
		if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
			local root = target.Character.HumanoidRootPart
			camera.CFrame = CFrame.lookAt(camera.CFrame.Position, root.Position)
		end
	end
end)