--// LOCK-ON AIM (PC + Mobile)
-- Click once to lock, click again to unlock

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- SETTINGS
local FOV_RADIUS = 100
local FOV_COLOR = Color3.fromRGB(255, 255, 255)
local CAMERA_LOCK_SPEED = 0.3 -- cÃ ng cao cÃ ng nhanh

-- UI setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "LockOnUI"
screenGui.Parent = player:WaitForChild("PlayerGui")

-- FOV circle
local fovCircle = Instance.new("Frame")
fovCircle.Name = "FOVCircle"
fovCircle.Size = UDim2.fromOffset(FOV_RADIUS * 2, FOV_RADIUS * 2)
fovCircle.AnchorPoint = Vector2.new(0.5, 0.5)
fovCircle.Position = UDim2.fromScale(0.5, 0.5)
fovCircle.BorderSizePixel = 2
fovCircle.BorderColor3 = FOV_COLOR
fovCircle.BackgroundTransparency = 1
fovCircle.Parent = screenGui

-- AIM toggle button
local aimButton = Instance.new("TextButton")
aimButton.Name = "AimToggleButton"
aimButton.Size = UDim2.fromScale(0.18, 0.1)
aimButton.Position = UDim2.fromScale(0.85, 0.8)
aimButton.AnchorPoint = Vector2.new(0.5, 0.5)
aimButton.Text = "ðŸŽ¯ LOCK: OFF"
aimButton.TextScaled = true
aimButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
aimButton.TextColor3 = Color3.fromRGB(0, 0, 0)
aimButton.Parent = screenGui

-- Variables
local lockedTarget = nil

-- Get center of screen
local function getCenter()
	local viewport = camera.ViewportSize
	return Vector2.new(viewport.X / 2, viewport.Y / 2)
end

-- Find closest player within FOV
local function getClosestPlayer()
	local center = getCenter()
	local closest
	local shortest = math.huge

	for _, plr in pairs(Players:GetPlayers()) do
		if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
			local root = plr.Character.HumanoidRootPart
			local pos, visible = camera:WorldToViewportPoint(root.Position)
			if visible then
				local dist = (Vector2.new(pos.X, pos.Y) - center).Magnitude
				if dist < FOV_RADIUS and dist < shortest then
					closest = plr
					shortest = dist
				end
			end
		end
	end
	return closest
end

-- Highlight target
local function updateHighlights(target)
	for _, plr in pairs(Players:GetPlayers()) do
		if plr ~= player and plr.Character then
			local hl = plr.Character:FindFirstChildOfClass("Highlight")
			if plr == target then
				if not hl then
					hl = Instance.new("Highlight")
					hl.FillTransparency = 1
					hl.OutlineTransparency = 0
					hl.OutlineColor = FOV_COLOR
					hl.Parent = plr.Character
				end
			elseif hl then
				hl:Destroy()
			end
		end
	end
end

-- Update camera lock
RunService.RenderStepped:Connect(function()
	if lockedTarget and lockedTarget.Character and lockedTarget.Character:FindFirstChild("HumanoidRootPart") then
		local root = lockedTarget.Character.HumanoidRootPart
		camera.CFrame = camera.CFrame:Lerp(CFrame.lookAt(camera.CFrame.Position, root.Position), CAMERA_LOCK_SPEED)
	else
		lockedTarget = nil
	end
	updateHighlights(lockedTarget)
end)

-- Button pressed
aimButton.MouseButton1Click:Connect(function()
	if lockedTarget then
		-- Unlock
		lockedTarget = nil
		aimButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
		aimButton.Text = "ðŸŽ¯ LOCK: OFF"
	else
		-- Try lock
		local target = getClosestPlayer()
		if target then
			lockedTarget = target
			aimButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
			aimButton.Text = "ðŸŽ¯ LOCK: ON"
		end
	end
end)

-- Optional: Toggle with keyboard (E key on PC)
UserInputService.InputBegan:Connect(function(input, gp)
	if gp then return end
	if input.KeyCode == Enum.KeyCode.E then
		aimButton:Activate()
	end
end)