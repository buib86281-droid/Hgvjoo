-- üåå Purple Beam v7 ‚Äì Glow Button Edition (Visual Only)
-- üíú Beam + Aura + N√∫t tr√≤n ph√°t s√°ng cho mobile & PC
-- üìç D√°n v√†o StarterPlayer > StarterPlayerScripts

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer or Players.PlayerAdded:Wait()
local camera = Workspace.CurrentCamera

-- ‚öôÔ∏è C·∫•u h√¨nh
local FOV = 80
local MAX_DIST = 150

local beamEnabled = false
local currentTarget = nil
local beam, att0, att1, aura, glowLight, highlight

-- üü£ GUI
local gui = Instance.new("ScreenGui")
gui.Name = "PurpleBeamGUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- üå∏ N√∫t tr√≤n ph√°t s√°ng
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0, 100, 0, 100)
toggleBtn.Position = UDim2.new(0.8, 0, 0.7, 0)
toggleBtn.BackgroundColor3 = Color3.fromRGB(130, 0, 255)
toggleBtn.Text = "‚ö°"
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 40
toggleBtn.Draggable = true
toggleBtn.Active = true
toggleBtn.Parent = gui

local corner = Instance.new("UICorner", toggleBtn)
corner.CornerRadius = UDim.new(1, 0)

-- üü™ Hi·ªáu ·ª©ng ph√°t s√°ng t√≠m
local uiStroke = Instance.new("UIStroke", toggleBtn)
uiStroke.Thickness = 3
uiStroke.Color = Color3.fromRGB(200, 150, 255)
uiStroke.Transparency = 0.4

-- Hi·ªáu ·ª©ng s√°ng nh·∫•p nh√°y
task.spawn(function()
	while task.wait(0.1) do
		if beamEnabled then
			uiStroke.Transparency = math.random(20, 60) / 100
		else
			uiStroke.Transparency = 0.4
		end
	end
end)

-- üü£ Aura t√≠m quanh ng∆∞·ªùi
local function createAura()
	local char = player.Character or player.CharacterAdded:Wait()
	local root = char:WaitForChild("HumanoidRootPart")

	if not glowLight then
		glowLight = Instance.new("PointLight", root)
		glowLight.Color = Color3.fromRGB(200,150,255)
		glowLight.Range = 10
		glowLight.Brightness = 1.8
	end

	if not aura then
		aura = Instance.new("ParticleEmitter", root)
		aura.Texture = "rbxassetid://6971861639"
		aura.Color = ColorSequence.new(Color3.fromRGB(180,100,255), Color3.fromRGB(255,200,255))
		aura.Size = NumberSequence.new(2)
		aura.LightEmission = 1
		aura.Rate = 10
		aura.Speed = NumberRange.new(0)
		aura.Lifetime = NumberRange.new(1)
		aura.LockedToPart = true
	end
end

-- üéØ T√¨m NPC g·∫ßn nh·∫•t trong FOV
local function getClosestInFOV()
	local closest, minDist = nil, math.huge
	for _, model in ipairs(Workspace:GetChildren()) do
		if model:IsA("Model") and model:FindFirstChild("Humanoid") and model:FindFirstChild("Head") then
			if model ~= player.Character then
				local head = model.Head
				local dir = (head.Position - camera.CFrame.Position)
				local angle = math.deg(math.acos(camera.CFrame.LookVector:Dot(dir.Unit)))
				if angle <= FOV then
					local dist = dir.Magnitude
					if dist < minDist and dist < MAX_DIST then
						minDist = dist
						closest = model
					end
				end
			end
		end
	end
	return closest
end

-- ‚ö° Toggle Beam
local function toggleBeam()
	beamEnabled = not beamEnabled
	toggleBtn.BackgroundColor3 = beamEnabled and Color3.fromRGB(170, 60, 255) or Color3.fromRGB(130, 0, 255)

	if not beamEnabled then
		for _, v in ipairs({beam, att0, att1, highlight}) do
			if v then v:Destroy() end
		end
		currentTarget = nil
	end
end

toggleBtn.MouseButton1Click:Connect(toggleBeam)

-- üîÆ C·∫≠p nh·∫≠t beam
RunService.RenderStepped:Connect(function()
	if not beamEnabled then return end
	createAura()

	local target = getClosestInFOV()
	local char = player.Character
	if not char or not char:FindFirstChild("Head") then return end
	local head = char.Head

	if target ~= currentTarget then
		for _, v in ipairs({beam, att0, att1, highlight}) do
			if v then v:Destroy() end
		end
		currentTarget = target

		if target and target:FindFirstChild("Head") then
			local targetHead = target.Head

			-- Highlight t√≠m
			highlight = Instance.new("Highlight")
			highlight.Adornee = target
			highlight.FillColor = Color3.fromRGB(180,100,255)
			highlight.FillTransparency = 0.5
			highlight.OutlineColor = Color3.new(1,1,1)
			highlight.Parent = target

			-- Beam gi·ªØa 2 ng∆∞·ªùi
			att0 = Instance.new("Attachment", head)
			att1 = Instance.new("Attachment", targetHead)
			beam = Instance.new("Beam")
			beam.Attachment0 = att0
			beam.Attachment1 = att1
			beam.Color = ColorSequence.new(Color3.fromRGB(180,100,255), Color3.fromRGB(255,200,255))
			beam.LightEmission = 0.8
			beam.Width0 = 0.25
			beam.Width1 = 0.25
			beam.Texture = "rbxassetid://1302071761"
			beam.TextureSpeed = 2
			beam.TextureLength = 4
			beam.Parent = head
		end
	end
end)